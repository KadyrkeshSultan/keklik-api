language: python
cache: pip
services:
  - postgresql
python:
  - 3.6
addons:
  postgresql: "9.5"
  ssh_known_hosts: 46.229.213.75
install: pip install -r requirements.txt
before_script:
  - psql -c 'create database test_db;' -U postgres
script:
  - python manage.py collectstatic
  # run test suite
  - python manage.py test
after_success:
  # start ssh agent and add private key
  - eval "$(ssh-agent -s)"
  - chmod 600 deploy_key
  - ssh-add deploy_key
  # configure remote repository
  - git remote add deploy keklik@46.229.213.75:/home/keklik/keklik-api.git
  # push master branch to production
  - git push -f deploy master
